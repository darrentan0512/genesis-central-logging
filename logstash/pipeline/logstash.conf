# logstash/pipeline/logstash.conf
input {
  # Beats (Filebeat/Winlogbeat/etc.)
  beats {
    port => 5044
  }

  # JSON over TCP (e.g., from apps or Fluent Bit)
  tcp {
    port => 5050
    codec => json
  }

  # JSON over UDP (low priority / best-effort)
  udp {
    port => 5050
    codec => json
  }
}

filter {
  # Normalize common timestamp fields if present
  date {
    match => ["timestamp", "ISO8601"]
    target => "@timestamp"
  }

  mutate {
    # Ensure host fields exist for ECS-like structure
    add_field => { "host.name" => "%{[host]}" }
    remove_field => ["host"]
  }
}

output {
  elasticsearch {
    hosts => [ "http://elasticsearch:9200" ]
    # Use a static index name for testing
    index => "logstash-tcp-%{+YYYY.MM.dd}"
  }

  # For local debugging
  stdout { codec => rubydebug }
}
